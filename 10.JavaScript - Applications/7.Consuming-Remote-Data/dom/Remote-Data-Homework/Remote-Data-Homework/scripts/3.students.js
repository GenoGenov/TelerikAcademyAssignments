// Generated by CoffeeScript 1.7.1
(function() {
        var $students, $errorMessage, $successMessage, addStudent, reloadStudents, resourceUrl;

        $students = $('#students-system');

        resourceUrl = 'http://localhost:3000/students';

        $successMessage = $students.find('.messages .success');

        $errorMessage = $students.find('.messages .error');

        addStudent = function(data) {
            return $.ajax({
                url: resourceUrl,
                type: 'POST',
                data: JSON.stringify(data),
                contentType: 'application/json',
                success: function(data) {
                    $successMessage
                        .html('' + data.name + ' successfully added')
                        .show()
                        .fadeOut(2000);
                    reloadStudents();
                },
                error: function(err) {
                    $errorMessage
                        .html('Error happened: ' + err)
                        .show()
                        .fadeOut(2000);
                }
            });
        };

        removeStudent = function(id) {
            return $.ajax({
                url: resourceUrl+'/'+id+'/',
                type: 'POST',
                data: {_method:'delete'},
                success: function (data) {
                    console.log(data);
                    $successMessage
                        .html('Student successfully deleted')
                        .show()
                        .fadeOut(2000);
                    reloadStudents();
                },
                error: function(err) {
                    $errorMessage
                        .html('Error happened: ' + err)
                        .show()
                        .fadeOut(2000);
                }
            });
        };
        getStudents = function (callback, error) {
            error = error || function() {};
            return $.getJSON(resourceUrl).then(callback).fail(error);
        };
        reloadStudents = function(showID) {
            getStudents(function(data) {
                    var student, $studentsList, i, len;
                    $studentsList = $('<ul/>').addClass('students-list');
                    for (i = 0, len = data.students.length; i < len; i++) {
                        student = data.students[i];
                        var $student = $('<li />')
                            .addClass('student-item')
                            .append($('<strong /> ')
                                .html(student.name))
                            .append($('<span />')
                                .html(student.grade));
                        if (showID === true) {
                            $student.append($('<strong /> ')
                                .html(' ID: ' + student.id));
                        }
                        $student.appendTo($studentsList);
                    }
                    $('#students-container').html($studentsList);
                },
                function() {
                    $errorMessage
                        .html("Error happened: " + err)
                        .show()
                        .fadeOut(2000);
                });
        };

        $(function() {
            reloadStudents();
            $('#btn-add-student').on('click', function() {
                var student;
                student = {
                    name: $('#tb-name').val(),
                    grade: $('#tb-grade').val()
                };
                addStudent(student);
            });
            $('#btn-show-id').on('click', function() {
                $students.addClass('disabled');
                $('#authorization').show().find('#cancel').on('click', function() {
                    $('#authorization').hide();
                    $students.removeClass('disabled');
                });
                $('#authorization').show().find('#ok').on('click', function() {
                    $('#authorization').hide();
                    $students.removeClass('disabled');
                    reloadStudents(true);

                });

            });

            $('#btn-delete').on('click',function() {
                var id = parseInt($('#tb-id').val());
                removeStudent(id);
            })
        });
    }).
    call(this);

//# sourceMappingURL=scripts.map